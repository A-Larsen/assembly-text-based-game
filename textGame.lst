     1                                  extern memalloc
     2                                  global main
     3                                  
     4                                  section .data
     5 00000000 576861742069732079-         fmt_name db 'What is your name: ', 0
     5 00000009 6F7572206E616D653A-
     5 00000012 2000               
     6                                      fmt_name_len equ $ - fmt_name - 1
     7                                      SYS_READ equ 0
     8                                      SYS_WRITE equ 1
     9                                      MAX_NAME_SIZE equ 10
    10                                  
    11                                  section .bss
    12 00000000 <res Ah>                    buffer resb MAX_NAME_SIZE
    13                                  
    14                                  section .text
    15                                  
    16                                  string_size:
    17 00000000 55                          push rbp
    18 00000001 4889E5                      mov rbp, rsp
    19                                  
    20 00000004 4831C0                      xor rax, rax ; string size
    21                                  .loop:
    22 00000007 803C0700                    cmp byte [rdi + rax], 0
    23 0000000B 7405                        je .end
    24 0000000D 48FFC0                      inc rax
    25 00000010 EBF5                        jmp .loop
    26                                  .end:
    27 00000012 C9                          leave
    28 00000013 C3                          ret
    29                                  
    30                                  print_string:
    31 00000014 55                          push rbp
    32 00000015 4889E5                      mov rbp, rsp
    33                                  
    34                                      ; I'm not using rax so I'm going to restore it
    35 00000018 50                          push rax
    36 00000019 53                          push rbx
    37 0000001A 51                          push rcx
    38                                  
    39 0000001B 4889F9                      mov rcx, rdi
    40                                  
    41 0000001E E8DDFFFFFF                  call string_size
    42 00000023 4889C3                      mov rbx, rax
    43                                  
    44 00000026 B801000000                  mov rax, 1
    45 0000002B BF01000000                  mov rdi, 1
    46 00000030 4889CE                      mov rsi, rcx
    47 00000033 4889DA                      mov rdx, rbx
    48 00000036 0F05                        syscall
    49                                  
    50 00000038 59                          pop rcx
    51 00000039 5B                          pop rbx
    52 0000003A 58                          pop rax
    53                                  
    54 0000003B C9                          leave
    55 0000003C C3                          ret
    56                                  
    57                                  initialize_string:
    58 0000003D 55                          push rbp
    59 0000003E 4889E5                      mov rbp, rsp
    60                                  
    61 00000041 51                          push rcx
    62                                  
    63 00000042 B90A000000                  mov rcx, MAX_NAME_SIZE
    64                                  
    65                                  .loop:
    66 00000047 C6040F00                    mov byte [rdi + rcx], 0
    67 0000004B E2FA                        loop .loop
    68                                  
    69 0000004D 59                          pop rcx
    70                                  
    71 0000004E C9                          leave
    72 0000004F C3                          ret
    73                                  
    74                                  input:
    75 00000050 55                          push rbp
    76 00000051 4889E5                      mov rbp, rsp
    77                                  
    78 00000054 53                          push rbx
    79                                  
    80 00000055 4889D3                      mov rbx, rdx
    81                                  
    82                                      ; write prompt
    83 00000058 4889F0                      mov rax, rsi ; temp
    84 0000005B 4889FE                      mov rsi, rdi ; string
    85 0000005E 4889C2                      mov rdx, rax ; length
    86 00000061 B801000000                  mov rax, SYS_WRITE
    87 00000066 BF01000000                  mov rdi, 1
    88 0000006B 0F05                        syscall
    89                                  
    90                                      ; Get user input
    91 0000006D B800000000                  mov rax, SYS_READ
    92 00000072 BF00000000                  mov rdi, 0 ; file descriptor
    93 00000077 BA0A000000                  mov rdx, MAX_NAME_SIZE ; size
    94 0000007C 4889DE                      mov rsi, rbx ; buffer
    95 0000007F 0F05                        syscall
    96                                  
    97 00000081 5B                          pop rbx
    98                                  
    99 00000082 C9                          leave
   100 00000083 C3                          ret
   101                                  
   102                                  exit:
   103 00000084 55                          push rbp
   104 00000085 4889E5                      mov rbp, rsp
   105                                  
   106 00000088 B83C000000                  mov rax, 60
   107 0000008D 4831FF                      xor rdi, rdi
   108 00000090 0F05                        syscall
   109                                  
   110 00000092 C9                          leave
   111 00000093 C3                          ret
   112                                  
   113                                  main:
   114 00000094 48BF-                       mov rdi, buffer
   114 00000096 [0000000000000000] 
   115 0000009E E89AFFFFFF                  call initialize_string
   116                                  
   117 000000A3 48BF-                       mov rdi, fmt_name
   117 000000A5 [0000000000000000] 
   118 000000AD BE13000000                  mov rsi, fmt_name_len
   119 000000B2 48BA-                       mov rdx, buffer
   119 000000B4 [0000000000000000] 
   120 000000BC E88FFFFFFF                  call input
   121                                  debug:
   122                                  
   123 000000C1 48BF-                       mov rdi, buffer
   123 000000C3 [0000000000000000] 
   124 000000CB E830FFFFFF                  call string_size
   125                                  
   126 000000D0 488B3C25[00000000]          mov rdi, [buffer]
   127 000000D8 4889C6                      mov rsi, rax
   128 000000DB E8(00000000)                call memalloc
   129                                  
   130 000000E0 48BF-                       mov rdi, buffer
   130 000000E2 [0000000000000000] 
   131 000000EA E825FFFFFF                  call print_string
   132                                  
   133 000000EF E890FFFFFF                  call exit
   134                                  
   135                                  
